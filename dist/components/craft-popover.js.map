{"version":3,"sources":["../../src/components/craft-popover.tsx"],"sourcesContent":["\"use client\";\n\nimport * as React from \"react\";\n\nimport { cn } from \"@/utils/cn\";\nimport type { ThemeName } from \"@/theme/theme-context\";\n\ntype PopoverAlign = \"start\" | \"center\" | \"end\";\n\nexport type CraftPopoverProps = {\n  open?: boolean;\n  defaultOpen?: boolean;\n  onOpenChange?: (open: boolean) => void;\n  trigger: React.ReactNode;\n  content: React.ReactNode;\n  align?: PopoverAlign;\n  sideOffset?: number;\n  tone?: ThemeName;\n  className?: string;\n  contentClassName?: string;\n};\n\nconst alignClasses: Record<PopoverAlign, string> = {\n  start: \"left-0\",\n  center: \"left-1/2 -translate-x-1/2\",\n  end: \"right-0\",\n};\n\nexport function CraftPopover({\n  open,\n  defaultOpen = false,\n  onOpenChange,\n  trigger,\n  content,\n  align = \"start\",\n  sideOffset = 10,\n  tone,\n  className,\n  contentClassName,\n}: CraftPopoverProps) {\n  const [uncontrolledOpen, setUncontrolledOpen] = React.useState(defaultOpen);\n  const isControlled = typeof open === \"boolean\";\n  const isOpen = isControlled ? open : uncontrolledOpen;\n  const rootRef = React.useRef<HTMLDivElement>(null);\n\n  const setOpen = React.useCallback(\n    (next: boolean) => {\n      if (!isControlled) setUncontrolledOpen(next);\n      onOpenChange?.(next);\n    },\n    [isControlled, onOpenChange]\n  );\n\n  React.useEffect(() => {\n    if (!isOpen) return;\n    const handleClick = (event: MouseEvent) => {\n      if (!rootRef.current) return;\n      if (!rootRef.current.contains(event.target as Node)) setOpen(false);\n    };\n    const handleKey = (event: KeyboardEvent) => {\n      if (event.key === \"Escape\") setOpen(false);\n    };\n    document.addEventListener(\"mousedown\", handleClick);\n    document.addEventListener(\"keydown\", handleKey);\n    return () => {\n      document.removeEventListener(\"mousedown\", handleClick);\n      document.removeEventListener(\"keydown\", handleKey);\n    };\n  }, [isOpen, setOpen]);\n\n  type TriggerProps = { onClick?: (event: React.MouseEvent) => void; \"aria-expanded\"?: boolean; \"aria-haspopup\"?: string };\n  const triggerNode = React.isValidElement(trigger)\n    ? React.cloneElement(trigger as React.ReactElement<TriggerProps>, {\n        onClick: (event: React.MouseEvent) => {\n          const handler = (trigger.props as TriggerProps).onClick;\n          handler?.(event);\n          if (!event.defaultPrevented) setOpen(!isOpen);\n        },\n        \"aria-expanded\": isOpen,\n        \"aria-haspopup\": \"dialog\",\n      })\n    : (\n        <button\n          type=\"button\"\n          onClick={() => setOpen(!isOpen)}\n          className=\"inline-flex\"\n          aria-expanded={isOpen}\n          aria-haspopup=\"dialog\"\n        >\n          {trigger}\n        </button>\n      );\n\n  return (\n    <div className={cn(\"relative inline-flex\", className)} ref={rootRef}>\n      {triggerNode}\n      {isOpen && (\n        <div\n          className={cn(\n            \"absolute z-40 w-max min-w-48 rounded-2xl border border-[rgb(var(--nc-border)/0.35)] bg-[rgb(var(--nc-surface)/0.08)] p-3 text-[rgb(var(--nc-fg))] shadow-[0_18px_40px_rgba(0,0,0,0.35)] backdrop-blur-2xl\",\n            alignClasses[align],\n            contentClassName\n          )}\n          style={{ marginTop: sideOffset }}\n          role=\"dialog\"\n          data-nc-theme={tone}\n        >\n          {content}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"mappings":";AAkFQ,cAYJ,YAZI;AAhFR,YAAY,WAAW;AAEvB,SAAS,UAAU;AAkBnB,MAAM,eAA6C;AAAA,EACjD,OAAO;AAAA,EACP,QAAQ;AAAA,EACR,KAAK;AACP;AAEO,SAAS,aAAa;AAAA,EAC3B;AAAA,EACA,cAAc;AAAA,EACd;AAAA,EACA;AAAA,EACA;AAAA,EACA,QAAQ;AAAA,EACR,aAAa;AAAA,EACb;AAAA,EACA;AAAA,EACA;AACF,GAAsB;AACpB,QAAM,CAAC,kBAAkB,mBAAmB,IAAI,MAAM,SAAS,WAAW;AAC1E,QAAM,eAAe,OAAO,SAAS;AACrC,QAAM,SAAS,eAAe,OAAO;AACrC,QAAM,UAAU,MAAM,OAAuB,IAAI;AAEjD,QAAM,UAAU,MAAM;AAAA,IACpB,CAAC,SAAkB;AACjB,UAAI,CAAC,aAAc,qBAAoB,IAAI;AAC3C,mDAAe;AAAA,IACjB;AAAA,IACA,CAAC,cAAc,YAAY;AAAA,EAC7B;AAEA,QAAM,UAAU,MAAM;AACpB,QAAI,CAAC,OAAQ;AACb,UAAM,cAAc,CAAC,UAAsB;AACzC,UAAI,CAAC,QAAQ,QAAS;AACtB,UAAI,CAAC,QAAQ,QAAQ,SAAS,MAAM,MAAc,EAAG,SAAQ,KAAK;AAAA,IACpE;AACA,UAAM,YAAY,CAAC,UAAyB;AAC1C,UAAI,MAAM,QAAQ,SAAU,SAAQ,KAAK;AAAA,IAC3C;AACA,aAAS,iBAAiB,aAAa,WAAW;AAClD,aAAS,iBAAiB,WAAW,SAAS;AAC9C,WAAO,MAAM;AACX,eAAS,oBAAoB,aAAa,WAAW;AACrD,eAAS,oBAAoB,WAAW,SAAS;AAAA,IACnD;AAAA,EACF,GAAG,CAAC,QAAQ,OAAO,CAAC;AAGpB,QAAM,cAAc,MAAM,eAAe,OAAO,IAC5C,MAAM,aAAa,SAA6C;AAAA,IAC9D,SAAS,CAAC,UAA4B;AACpC,YAAM,UAAW,QAAQ,MAAuB;AAChD,yCAAU;AACV,UAAI,CAAC,MAAM,iBAAkB,SAAQ,CAAC,MAAM;AAAA,IAC9C;AAAA,IACA,iBAAiB;AAAA,IACjB,iBAAiB;AAAA,EACnB,CAAC,IAEC;AAAA,IAAC;AAAA;AAAA,MACC,MAAK;AAAA,MACL,SAAS,MAAM,QAAQ,CAAC,MAAM;AAAA,MAC9B,WAAU;AAAA,MACV,iBAAe;AAAA,MACf,iBAAc;AAAA,MAEb;AAAA;AAAA,EACH;AAGN,SACE,qBAAC,SAAI,WAAW,GAAG,wBAAwB,SAAS,GAAG,KAAK,SACzD;AAAA;AAAA,IACA,UACC;AAAA,MAAC;AAAA;AAAA,QACC,WAAW;AAAA,UACT;AAAA,UACA,aAAa,KAAK;AAAA,UAClB;AAAA,QACF;AAAA,QACA,OAAO,EAAE,WAAW,WAAW;AAAA,QAC/B,MAAK;AAAA,QACL,iBAAe;AAAA,QAEd;AAAA;AAAA,IACH;AAAA,KAEJ;AAEJ;","names":[]}