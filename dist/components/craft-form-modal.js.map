{"version":3,"sources":["../../src/components/craft-form-modal.tsx"],"sourcesContent":["\"use client\";\n\nimport * as React from \"react\";\nimport {\n  FormProvider,\n  type DefaultValues,\n  type FieldValues,\n  type Path,\n  type RegisterOptions,\n  useForm,\n} from \"react-hook-form\";\n\nimport { cn } from \"@/utils/cn\";\nimport type { ThemeName } from \"@/theme/theme-context\";\nimport { CraftModal } from \"@/components/craft-modal\";\nimport { CraftButton } from \"@/components/craft-button\";\nimport {\n  CraftFormField,\n  type CraftFormFieldOption,\n  type CraftFormFieldType,\n} from \"@/components/craft-form-field\";\n\nexport type CraftFormModalField<TValues extends FieldValues> = {\n  name: Path<TValues>;\n  label?: React.ReactNode;\n  description?: React.ReactNode;\n  type: CraftFormFieldType;\n  placeholder?: string;\n  options?: CraftFormFieldOption[];\n  required?: boolean;\n  disabled?: boolean;\n  rules?: RegisterOptions<TValues>;\n  defaultValue?: unknown;\n  min?: number;\n  max?: number;\n  step?: number;\n  rows?: number;\n  accept?: string;\n  minFiles?: number;\n  maxFiles?: number;\n  helpText?: React.ReactNode;\n  fieldProps?: Record<string, unknown>;\n  validate?: (value: unknown, values: TValues) => string | boolean | undefined;\n};\n\nexport type CraftFormModalProps<TValues extends FieldValues> = {\n  title?: React.ReactNode;\n  description?: React.ReactNode;\n  fields: Array<CraftFormModalField<TValues>>;\n  initialData?: Partial<TValues> | null;\n  open?: boolean;\n  defaultOpen?: boolean;\n  onOpenChange?: (open: boolean) => void;\n  trigger?: React.ReactNode;\n  submitLabel?: React.ReactNode;\n  cancelLabel?: React.ReactNode;\n  resetLabel?: React.ReactNode;\n  showReset?: boolean;\n  showCancel?: boolean;\n  tone?: ThemeName;\n  className?: string;\n  formClassName?: string;\n  loading?: boolean;\n  disableSubmitWhenInvalid?: boolean;\n  closeOnSubmit?: boolean;\n  closeOnCancel?: boolean;\n  onSubmit: (values: TValues) => void | Promise<void>;\n  onReset?: () => void;\n  onCancel?: () => void;\n  customValidation?: (values: TValues) => Partial<Record<Path<TValues>, string>>;\n};\n\nfunction defaultValueForField<TValues extends FieldValues>(\n  field: CraftFormModalField<TValues>\n) {\n  if (field.defaultValue !== undefined) return field.defaultValue;\n  switch (field.type) {\n    case \"checkbox\":\n    case \"switch\":\n      return false;\n    case \"number\":\n    case \"slider\":\n    case \"range\":\n      return field.min ?? 0;\n    case \"multifile\":\n      return [];\n    case \"file\":\n      return null;\n    case \"multiselect\":\n      return [];\n    case \"radio\":\n      return field.options?.[0]?.value ?? \"\";\n    default:\n      return \"\";\n  }\n}\n\nfunction buildDefaultValues<TValues extends FieldValues>(\n  fields: Array<CraftFormModalField<TValues>>,\n  initialData?: Partial<TValues> | null\n): DefaultValues<TValues> {\n  const values = {} as Record<string, unknown>;\n  fields.forEach((field) => {\n    const initialValue = initialData?.[field.name as keyof TValues];\n    if (initialValue !== undefined && initialValue !== null) {\n      values[field.name] = initialValue;\n    } else {\n      values[field.name] = defaultValueForField(field);\n    }\n  });\n  return values as DefaultValues<TValues>;\n}\n\nfunction buildRules<TValues extends FieldValues>(\n  field: CraftFormModalField<TValues>,\n  getValues: () => TValues\n): RegisterOptions<TValues> {\n  const rules: RegisterOptions<TValues> = { ...field.rules };\n  const mergeValidate = (\n    current: RegisterOptions<TValues>[\"validate\"],\n    next: (value: unknown) => string | boolean | undefined\n  ) => {\n    if (!current) return next;\n    if (typeof current === \"function\") {\n      return (value: unknown): string | boolean | undefined => {\n        const result = (current as (value: unknown, values: TValues) => string | boolean | undefined)(\n          value,\n          getValues()\n        );\n        if (result !== true) return result as string | undefined;\n        return next(value);\n      };\n    }\n    if (typeof current === \"object\") {\n      return (value: unknown): string | boolean | undefined => {\n        const entries = Object.entries(current);\n        for (const [, validator] of entries) {\n          const result = (validator as (value: unknown, values: TValues) => string | boolean | undefined)(\n            value,\n            getValues()\n          );\n          if (result !== true) return result as string | undefined;\n        }\n        return next(value);\n      };\n    }\n    return next;\n  };\n\n  if (field.required && field.type !== \"hidden\") {\n    if (field.type === \"checkbox\" || field.type === \"switch\") {\n      rules.validate = mergeValidate(\n        rules.validate,\n        (value: unknown): string | boolean | undefined =>\n          value ? true : `${String(field.label ?? field.name)} is required`\n      );\n    } else if (field.type === \"multiselect\") {\n      rules.validate = mergeValidate(\n        rules.validate,\n        (value: unknown): string | boolean | undefined =>\n          Array.isArray(value) && value.length > 0\n            ? true\n            : `${String(field.label ?? field.name)} is required`\n      );\n    } else if (field.type === \"file\") {\n      rules.validate = mergeValidate(\n        rules.validate,\n        (value: unknown): string | boolean | undefined =>\n          value instanceof FileList && value.length > 0\n            ? true\n            : `${String(field.label ?? field.name)} is required`\n      );\n    } else if (field.type === \"multifile\") {\n      rules.validate = mergeValidate(\n        rules.validate,\n        (value: unknown): string | boolean | undefined =>\n          Array.isArray(value) && value.length > 0\n            ? true\n            : `${String(field.label ?? field.name)} is required`\n      );\n    } else {\n      rules.required = `${String(field.label ?? field.name)} is required`;\n    }\n  }\n\n  if (field.min !== undefined) {\n    rules.min = { value: field.min, message: `Min ${field.min}` };\n  }\n  if (field.max !== undefined) {\n    rules.max = { value: field.max, message: `Max ${field.max}` };\n  }\n\n  if (field.type === \"email\") {\n    rules.pattern = {\n      value: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/,\n      message: \"Please enter a valid email address\",\n    };\n  }\n\n  if (field.type === \"url\") {\n    rules.pattern = {\n      value: /^https?:\\/\\/.+/,\n      message: \"Please enter a valid URL\",\n    };\n  }\n\n  if (field.validate) {\n    rules.validate = mergeValidate(\n      rules.validate,\n      (value: unknown): string | boolean | undefined =>\n        field.validate?.(value, getValues())\n    );\n  }\n\n  return rules;\n}\n\nexport function CraftFormModal<TValues extends FieldValues>({\n  title = \"Form\",\n  description,\n  fields,\n  initialData = null,\n  open,\n  defaultOpen = false,\n  onOpenChange,\n  trigger,\n  submitLabel = \"Submit\",\n  cancelLabel = \"Cancel\",\n  resetLabel = \"Reset\",\n  showReset = true,\n  showCancel = true,\n  tone,\n  className,\n  formClassName,\n  loading = false,\n  disableSubmitWhenInvalid = true,\n  closeOnSubmit = true,\n  closeOnCancel = true,\n  onSubmit,\n  onReset,\n  onCancel,\n  customValidation,\n}: CraftFormModalProps<TValues>) {\n  const [uncontrolledOpen, setUncontrolledOpen] = React.useState(defaultOpen);\n  const isControlled = typeof open === \"boolean\";\n  const isOpen = isControlled ? open : uncontrolledOpen;\n\n  const setOpen = React.useCallback(\n    (next: boolean) => {\n      if (!isControlled) setUncontrolledOpen(next);\n      onOpenChange?.(next);\n    },\n    [isControlled, onOpenChange]\n  );\n\n  const defaultValues = React.useMemo(\n    () => buildDefaultValues(fields, initialData),\n    [fields, initialData]\n  );\n\n  const form = useForm<TValues>({\n    mode: \"onChange\",\n    defaultValues,\n  });\n\n  const formId = React.useId();\n  const isSubmitDisabled =\n    disableSubmitWhenInvalid && !form.formState.isValid;\n\n  React.useEffect(() => {\n    form.reset(defaultValues);\n  }, [defaultValues, form]);\n\n  const handleSubmit = form.handleSubmit(async (values) => {\n    if (customValidation) {\n      const customErrors = customValidation(values);\n      if (customErrors && Object.keys(customErrors).length > 0) {\n        Object.entries(customErrors).forEach(([key, message]) => {\n          if (message) {\n            form.setError(key as Path<TValues>, {\n              type: \"custom\",\n              message: String(message),\n            });\n          }\n        });\n        return;\n      }\n    }\n\n    await onSubmit(values);\n    if (closeOnSubmit) setOpen(false);\n  });\n\n  const handleReset = () => {\n    form.reset(defaultValues);\n    onReset?.();\n  };\n\n  const handleCancel = () => {\n    onCancel?.();\n    if (closeOnCancel) setOpen(false);\n  };\n\n  return (\n    <FormProvider {...form}>\n      <CraftModal\n        open={isOpen}\n        onOpenChange={setOpen}\n        trigger={trigger}\n        title={title}\n        description={description}\n        tone={tone}\n        className={className}\n        footer={\n          <div className=\"flex flex-wrap items-center justify-end gap-3\">\n            {showReset && (\n              <CraftButton\n                type=\"button\"\n                variant=\"outline\"\n                onClick={handleReset}\n                disabled={loading}\n              >\n                {resetLabel}\n              </CraftButton>\n            )}\n            {showCancel && (\n              <CraftButton\n                type=\"button\"\n                variant=\"ghost\"\n                onClick={handleCancel}\n                disabled={loading}\n              >\n                {cancelLabel}\n              </CraftButton>\n            )}\n            <CraftButton\n              type=\"submit\"\n              variant=\"solid\"\n              loading={loading}\n              form={formId}\n              disabled={loading || isSubmitDisabled}\n            >\n              {submitLabel}\n            </CraftButton>\n          </div>\n        }\n      >\n        <form\n          id={formId}\n          onSubmit={handleSubmit}\n          className={cn(\"space-y-5\", formClassName)}\n        >\n          {fields.map((field) => (\n            <div key={field.name} className=\"space-y-2\">\n              <CraftFormField\n                name={field.name}\n                label={field.label}\n                description={field.description}\n                helpText={field.helpText}\n                required={field.required && !field.disabled}\n                type={field.type}\n                placeholder={field.placeholder}\n                options={field.options}\n                tone={tone}\n                disabled={field.disabled || loading}\n                rules={buildRules(field, form.getValues)}\n                fieldProps={{\n                  min: field.min,\n                  max: field.max,\n                  step: field.step,\n                  rows: field.rows,\n                  accept: field.accept,\n                  multiple: field.type === \"multifile\",\n                  ...field.fieldProps,\n                }}\n              />\n            </div>\n          ))}\n        </form>\n      </CraftModal>\n    </FormProvider>\n  );\n}\n"],"mappings":"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","names":["_a"]}